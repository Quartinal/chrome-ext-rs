name: Rust and Cargo Setup

on:
    push:
        branches:
            - main
        paths:
            - '.'

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
        - name: Checkout repository
          uses: actions/checkout@v4

        - name: Set up Rust toolchain
          uses: actions-rust-lang/setup-rust-toolchain@v1
          with:
            toolchain: stable

        - name: Check for existing Rust project
          run: |
            if [ ! -e Cargo.lock ]; then
                echo "Cargo.lock exists: false" >> $GITHUB_OUTPUT
            else
                echo "Cargo.lock exists: true" >> $GITHUB_OUTPUT
            fi
          env:
            GITHUB_OUTPUT: ${{ env.GITHUB_OUTPUT }}
          id: check

        - name: Initialize Rust project
          if: steps.check.outputs.Cargo_lock_exists == 'false'
          run: cargo new chrome-ext-rs --bin

        - name: Build
          run: cargo build --release
